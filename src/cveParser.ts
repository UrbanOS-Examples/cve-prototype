import { json } from "express";
import { exit } from "process";

function noMessage(rawMessage: string) {
    return (
        rawMessage === undefined ||
        rawMessage === null ||
        rawMessage.trim().length === 0
    );
}

export function parseMessage(rawMessage: string): void {
    let message: string;
    if (noMessage(rawMessage)) {
        return undefined;
    }
    const hardBrakingData = JSON.parse(rawMessage);
    if (hardBrakingData.payload.messageType === 'BSM') {
        parseCVE(hardBrakingData.payload.messageBody)
    }
}

export function parseCVE(hardBrakingDataString: string): void {
  
    let longAccelFtS2: number;
    let vehicleId = 0;
    let lat = 0;
    let long = 0;

    const hardBrakingData = JSON.parse(hardBrakingDataString)
    longAccelFtS2 = (hardBrakingData.coreData.accelSet.long) as number
    vehicleId = (hardBrakingData.coreData.id) as number
    lat = (hardBrakingData.coreData.lat) as number
    long = (hardBrakingData.coreData.long) as number
    longAccelFtS2 = longAccelFtS2 / 100 * 3.2808399;
    if (longAccelFtS2 < -15) {
        console.log("Hard Braking Event")
        console.log("Vehicle: " +vehicleId)
        console.log('Location: '+lat, ','+long)
    }
    console.log(longAccelFtS2)  
}
    